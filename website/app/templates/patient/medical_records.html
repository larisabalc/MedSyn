{% extends "base.html" %}
{% block title %}Medical Records{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>My Medical Records</h2>

    <div class="mb-3 mt-3">
        <input type="text" id="searchInput" class="form-control" placeholder="Search by doctor or keywords">
    </div>

    {% if records %}
        <div class="list-group mt-3" id="recordsList">
            {% for record in records %}
                <div class="list-group-item list-group-item-action mb-2 shadow-sm record-item">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="mb-1 doctor-name">
                                {% if record.doctor %}
                                    ðŸ©º Dr. {{ record.doctor.user.username }}
                                {% else %}
                                    ðŸ¤– AI Assistant
                                {% endif %}
                            </h5>
                            <p class="mb-1 symptoms"><strong>Symptoms:</strong> {{ record.symptoms or '-' }}</p>
                            <p class="mb-1 diagnosis"><strong>Diagnosis:</strong> {{ record.diagnosis or '-' }}</p>
                            {% if not record.is_generated %}
                                <p class="mb-1 treatment"><strong>Treatment:</strong> {{ record.treatment or '-' }}</p>
                            {% endif %}
                            <p class="mb-1">
                                <strong>Cholesterol:</strong> {{ record.cholesterol_lvl or '-' }},
                                <strong>Blood Pressure:</strong> {{ record.blood_pressure_lvl or '-' }}
                            </p>
                        </div>
                        <small class="text-muted">
                            {% if record.is_generated %}Generated{% else %}Manual{% endif %}
                        </small>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted mt-3">No medical records available.</p>
    {% endif %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('searchInput');
        const records = document.querySelectorAll('.record-item');

        searchInput.addEventListener('keyup', function () {
            const filter = this.value.toLowerCase();

            records.forEach(record => {
                const doctor = record.querySelector('.doctor-name')?.textContent.toLowerCase() || '';
                const symptoms = record.querySelector('.symptoms')?.textContent.toLowerCase() || '';
                const diagnosis = record.querySelector('.diagnosis')?.textContent.toLowerCase() || '';
                const treatment = record.querySelector('.treatment')?.textContent.toLowerCase() || '';

                const match =
                    doctor.includes(filter) ||
                    symptoms.includes(filter) ||
                    diagnosis.includes(filter) ||
                    treatment.includes(filter);

                record.style.display = match ? '' : 'none';
            });
        });
    });
</script>
{% endblock %}
