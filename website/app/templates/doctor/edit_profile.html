{% extends "base.html" %}
{% block title %}Edit Profile{% endblock %}

{% block content %}
<div class="container mt-5">

    <h3 class="mb-4">Edit Doctor Profile</h3>

    <form method="POST">
        <div class="row g-4">

            <div class="col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header fw-bold bg-light">
                        Personal Information
                    </div>
                    <div class="card-body">

                        <div class="mb-3">
                            <label class="form-label fw-bold">Full Name</label>
                            <input type="text" name="username" class="form-control"
                                    value="{{ user.username }}" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Gender</label>
                            <select name="gender" class="form-select" required>
                                <option value="">-- Select Gender --</option>
                                <option value="M" {% if user.gender == 'M' %}selected{% endif %}>Male</option>
                                <option value="F" {% if user.gender == 'F' %}selected{% endif %}>Female</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Date of Birth</label>
                            <input type="date" name="birth_date" class="form-control"
                                    value="{{ user.birth_date.strftime('%Y-%m-%d') if user.birth_date }}">
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Email</label>
                            <input type="email" class="form-control" value="{{ user.email }}" disabled>
                            <small class="text-muted">Email cannot be changed</small>
                        </div>

                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header fw-bold bg-light">
                        Doctor Details
                    </div>
                    <div class="card-body">

                        {% if doctor.specialization and doctor.specialization.specialization_name == 'Unnassigned' %}
                        <div class="alert alert-warning py-2" role="alert">
                            Your profile is incomplete. Please provide your <strong>Medical License Number</strong>
                            and select your <strong>Specialization</strong> to complete your account setup.
                        </div>
                        {% endif %}

                        <div class="mb-3">
                            <label class="form-label fw-bold">Medical License Number</label>
                            <input type="text" name="licence_no" class="form-control"
                                    value="{{ doctor.licence_no or '' }}">
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Specialization</label>
                            <select name="specialization_id" class="form-select" required>
                                <option value="">-- Select Specialization --</option>
                                {% for spec in specializations %}
                                    <option value="{{ spec.specialization_id }}"
                                        {% if doctor.specialization_id == spec.specialization_id %}selected{% endif %}>
                                        {{ spec.specialization_name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                    </div>
                </div>
            </div>

        </div>

        <div class="mt-4 d-flex justify-content-end gap-2">
            <a href="{{ url_for('doctor.profile') }}" class="btn btn-outline-secondary">
                Cancel
            </a>
            <button type="submit" class="btn btn-primary">
                Save Changes
            </button>
        </div>
    </form>

</div>
{% endblock %}
